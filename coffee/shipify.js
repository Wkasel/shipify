// Generated by CoffeeScript 1.3.1
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};window.S||(window.S={});$(function(){var b,c,d,e,f,g,h,i,j,k,l,m,n;localStorage.setItem("settings",JSON.stringify(window.S));console.log(localStorage.getItem("testObject"));console.log(JSON.parse(localStorage.getItem("testObject")));console.log("OMG");i=Haml("%tr\n  %td.username=username\n  %td.themesong=themesong\n  %td.range=range\n  %td\n    %a.preview<> play\n    |\n    %a.remove<> remove");g=getSpotifyApi(1);c=g.require("sp://import/scripts/api/models");d=c.player;b=function(){function b(b,d,e,f){this.fadeOut=a(this.fadeOut,this);this.end=a(this.end,this);this.play=a(this.play,this);this.remove=a(this.remove,this);this.render=a(this.render,this);this.track=c.Track.fromURI(b);this.start=d;this.stop=e;this.username=f;this.fadeTime=1500;this.render()}b.prototype.render=function(){var a,b=this;a=$(i({username:this.username,themesong:this.track,range:""+this.start/1e3+"s - "+this.stop/1e3+"s"}));a.find(".preview").click(function(){return b.play()});a.find(".remove").click(function(){return b.remove()});return a.appendTo($(".themesongs"))};b.prototype.remove=function(){return console.log("Removed")};b.prototype.play=function(){var a,b=this;S.playingTheme=!0;d.track=this.track;setTimeout(this.end,this.stop-this.start);a=function(){return d.track.name!==b.track.name?setTimeout(function(){return a()},100):d.position=b.start};return a()};b.prototype.end=function(){var a,b=this;d.track=S.track;a=function(){d.position=S.position;return d.track.name!==S.track.name?setTimeout(function(){return a()},100):S.playingTheme=!1};return a()};b.prototype.fadeOut=function(a){var b,c,e,f,g=this;a==null&&(a=function(){});c=this.fadeTime/10;e=function(a){return setTimeout(function(){d.volume=.1*a;return console.log(.1*a)},c*a)};for(b=f=10;f>=1;b=--f)e(b);return setTimeout(a,this.fadeTime)};return b}();j={};n=S.themesongs;m=function(a,c,d){return a[c]=new b(d[0],d[1],d[2],c)};for(l in n){f=n[l];m(j,l,f)}k=function(){var a;if(!S.playingTheme){a=d.track;S.position=d.position;S.track=a;if(a!=null)return $("#np").html(""+a)}};setInterval(k,200);e=io.connect(S.serverURL);e.on("connect",function(){return console.log("Connected!")});e.on("commit",function(a){var b,c;b=a;l=b.username;c=j[l];if(c!=null)return c.play()});h=function(){var a,b,d;a=c.application.arguments;b=$("#"+a[0]);d=$(".section").hide();return b.show()};h();return c.application.observe(c.EVENT.ARGUMENTSCHANGED,h)})}).call(this);